<!DOCTYPE html>
<html>
    <head>
        <title><%= title %></title>
        <meta charset='utf-8'>
        <link rel='stylesheet' href='/stylesheets/style.css' />
        <style>
            body{margin:0px; padding:0px;background-color:white;}
            table{font-size:15px; text-align:center;}
            input{height:30px; width:100%;}
            textarea{height:70px; width:100%;}
            .header{background-color:black; position:fixed; width:100%; top:0; left:0; z-index:1;}
            ul.nav{float:right; list-style:none; width:45%; height:20px;}
            ul.nav li{float:left; color:white;}
            ul.nav a{line-height:20px; color:#ffffff; padding:0 15px; text-decoration:none;}
      
            .bottom{line-height:50px; height:50px; width:100%; background-repeat:repeat; background-attachment: scroll; background-position:0% 0%; background-color:black;position:fixed; bottom:0pt; left:0pt;}
            .button{background-color:white; border:0px; color:black;text-decoration:none;}
            .button:hover{font-weight:bold; background-color:lightgray;}
            .log-but{border:1px solid black; width:95px; height:50px;}
            .log-but:hover{font-weight:bold;}
            a{text-decoration:none; color:black;}
            th, td { border-bottom: 1px solid #444444; padding: 10px; }
        </style>
        <script src = "/javascripts/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script>
            //버튼을 클릭해서 구매 수량을 +/-하는 함수
            //구매자 페이지에서만 나타나게 해야함?
            function count(type)  {
                // 결과를 표시할 element
                const resultElement = document.getElementById('quantity');
                
                // 현재 화면에 표시된 값
                let number = resultElement.innerText;
                
                // 더하기/빼기
                if(type === 'plus'){
                number = parseInt(number) + 1;
                }else if(type === 'minus'){
                number = parseInt(number) - 1;
                }//수량이 음수면 경고 메세지 출력하기
                // if(number < 0){
                //     alert('수량은 음수가 될 수 없습니다.');
                //     //근데 화면에는 여전히 -1이 출력됨!
                // }
                
                // 결과 출력
                resultElement.innerText = number;
            }
            function button_event(){
                if (confirm("정말 삭제하시겠습니까??") == true){    //확인
                    document.form.submit();
                }else{   //취소
                    return;
                }
            }
        </script>
    </head>
    <body>
        <div class="header">
            <div>
              <ul class="nav">
                <li style="float:right; margin-right:20px;"><a href='/'>메인페이지</a></li>
              </ul>
            </div>
        </div>
        <div style="margin-top:90px; margin-left:210px; width:130px; font-size:30px; margin-bottom:10px;">
            장바구니
        </div>
            <table width = "1000" height = "400" style="margin:0 auto; margin-top:20px;">
                <tr style="height:30px; text-align:center;">
                    <td>번호</td>
                    <td>표지</td>
                    <td>상품정보</td>
                    <td>판매가</td>
                    <td>수량</td>
                    <td colspan = "2">선택</td>
                </tr>
<%              if(rows.length == 0) { %>
               <tr>
                  <td colspan="6">
                     <center>장바구니에 담으신 상품이 없습니다.</center>
                  </td>
               </tr>
<% }else{ %>
    <%
                for(var i=0; i<rows.length; i++){
                    var oneItem = rows[i];
    %>
                <!-- <input type = "hidden" name="cart_num" value = "<%=rows.cart_num%>"/> -->
                <tr>
                    <td><%=oneItem.cart_num%></td>
                    <td><img src="/images/<%= oneItem.image %>" alt="" width="100px" height="50px"></td>
                    <td><a href="/book/detail/read/<%=oneItem.book_num%>"><%=oneItem.book_title%></a></td>
                    <td><%=oneItem.book_price%></td>
                    <td><%=oneItem.quantity%>
                        <input type='button'onclick='count("plus")'value='+'/>
                        <input type='button'onclick='count("minus")'value='-'/>
                        <div id='quantity'>0</div>
                    </td>
                    <!-- 이 밑부분도 구매/장바구니 페이지 여부에 따라 다름 -->
                    <td colspan = "2">
                        <form action="/orders/delete/cart" method="post">
                            <input type="hidden" name="cart_num" value = "<%=oneItem.cart_num%>">
                            <button type = "submit" onclick='button_event()'>장바구니에서 삭제</button>
                        </form>
                    </td>
                </tr>
    <%
                    }
    %>
<%
                }
%>
            </table>
        <!-- <form action = "/orders/buy" method="post">
            <tr>
                <td colspan = "2"> 
                    <input type = "button" id = "구매화면으로 이동" name = "구매화면으로 이동" value = "구매화면으로 이동" onclick="location.href = '/orders/buy'">
                </td>
            </tr>
        </form> -->
        <script>
            const handleInsert = (row) => {
                axios.post('http://localhost:3000/orders/buy',{params: row})
                .then(() => location.href = '/orders/buy').then(() => console.log('fdsfasd'));
                
            }
        </script>
        <div class="bottom" style="color:white;">
            <div style="float:left; margin-left:25px;"><strong>CONTACT</strong>&emsp;031-909-9999</div>
            <div style="float:right; margin-right:30px;"><strong>주소</strong>&emsp;서울특별시 노원구 월계3동 광운대학교</div>
          </div>
    
    </body>
</html>